<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°—Ç—Ä–∞—à–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏</title>
    <meta name="description" content="–°—Ç—Ä–∞—à–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏ ‚Äî —Å–æ–±—Ä–∞–Ω–∏–µ —Å–∞–º—ã—Ö –∂—É—Ç–∫–∏—Ö —Ä–∞—Å—Å–∫–∞–∑–æ–≤ —Å –ø—Ä–æ—Å—Ç–æ—Ä–æ–≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞. –ö–æ—Ä–æ—Ç–∫–∏–µ —Å—Ç—Ä–∞—à–∏–ª–∫–∏, –º–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å—Ç–æ—Ä–∏–∏, –ø—É–≥–∞—é—â–∏–µ –ª–µ–≥–µ–Ω–¥—ã.">
    <meta name="keywords" content="—Å—Ç—Ä–∞—à–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏, —Å—Ç—Ä–∞—à–∏–ª–∫–∏, —É–∂–∞—Å—ã, –º–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞—Å—Å–∫–∞–∑—ã, —Ö–æ—Ä—Ä–æ—Ä, –ø—É–≥–∞—é—â–∏–µ –∏—Å—Ç–æ—Ä–∏–∏, –ª–µ–≥–µ–Ω–¥—ã, –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏">
    <link rel="icon" type="image/png" href="./favicon.png" />
    <link rel="stylesheet" href="./style.css">
</head>
<body>
    <!-- –ü—Ä–µ–ª–æ–∞–¥–µ—Ä -->
    <div id="preloader" class="preloader">
        <div class="preloader-content">
            <div class="preloader-spinner"></div>
            <p>–ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞—à–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏...</p>
        </div>
    </div>

    <!-- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
    <header class="fixed-header">
        <div class="nav-left">
            <span class="nav-title">üëª –°—Ç—Ä–∞—à–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏</span>
            <a href="about.html">–û –ø—Ä–æ–µ–∫—Ç–µ</a>
        </div>
        <div class="nav-center">
            <div class="search-container">
                <input type="text" id="search-input" placeholder="üîç –ü–æ–∏—Å–∫ –∏—Å—Ç–æ—Ä–∏–π..." class="search-input">
                <button id="search-clear" class="search-clear" title="–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫">‚úï</button>
            </div>
        </div>
        <div class="nav-right">
            <button id="sort-alpha" class="sort-btn">–ê-–Ø</button>
            <button id="sort-default" class="sort-btn active">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</button>
            <button id="sort-reading" class="sort-btn">‚è±Ô∏è –í—Ä–µ–º—è —á—Ç–µ–Ω–∏—è</button>
            <button id="theme-toggle" class="control-btn theme-btn" title="–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É">üåô</button>
        </div>
    </header>

    <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ —Å–∞–π–¥–±–∞—Ä–∞ -->
    <button id="sidebar-toggle" class="sidebar-toggle" title="–û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é">‚ò∞</button>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å —Å–∞–π–¥–±–∞—Ä–æ–º -->
    <div class="main-container">
        <!-- –õ–µ–≤—ã–π —Å–∞–π–¥–±–∞—Ä —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h3>üéØ –§–∏–ª—å—Ç—Ä—ã</h3>
            </div>
            <div class="category-list">
                <button class="category-btn active" data-category="all">
                    <span class="category-icon">üìö</span>
                    <span class="category-name">–í—Å–µ –∏—Å—Ç–æ—Ä–∏–∏</span>
                </button>
                <!-- –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ—Å—Ç–∏ -->
                <div class="category-header">
                    <h4>üìñ –°—Ç–∞—Ç—É—Å —á—Ç–µ–Ω–∏—è</h4>
                </div>
                <button class="category-btn read-status-btn" data-read-status="unread">
                    <span class="category-icon">üìñ</span>
                    <span class="category-name">–ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ</span>
                </button>
                <button class="category-btn read-status-btn" data-read-status="read">
                    <span class="category-icon">‚úÖ</span>
                    <span class="category-name">–ü—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ</span>
                </button>
                <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </aside>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
        <main class="main-content">
            <h1>–°—Ç—Ä–∞—à–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏</h1>
            <p class="subtitle">–°–æ–±—Ä–∞–Ω–∏–µ —Å–∞–º—ã—Ö –∂—É—Ç–∫–∏—Ö —Ä–∞—Å—Å–∫–∞–∑–æ–≤ —Å –ø—Ä–æ—Å—Ç–æ—Ä–æ–≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞</p>
            
            <div class="stories-container">
                <ul id="stories-list">
                    <!-- –°–∫–µ–ª–µ—Ç–æ–Ω –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ -->
                    <li class="story-item skeleton skeleton-story">
                        <div class="skeleton-title"></div>
                        <div class="skeleton-meta"></div>
                    </li>
                    <li class="story-item skeleton skeleton-story">
                        <div class="skeleton-title"></div>
                        <div class="skeleton-meta"></div>
                    </li>
                    <li class="story-item skeleton skeleton-story">
                        <div class="skeleton-title"></div>
                        <div class="skeleton-meta"></div>
                    </li>
                    <li class="story-item skeleton skeleton-story">
                        <div class="skeleton-title"></div>
                        <div class="skeleton-meta"></div>
                    </li>
                    <li class="story-item skeleton skeleton-story">
                        <div class="skeleton-title"></div>
                        <div class="skeleton-meta"></div>
                    </li>
                    <li class="story-item skeleton skeleton-story">
                        <div class="skeleton-title"></div>
                        <div class="skeleton-meta"></div>
                    </li>
                </ul>
            </div>

            <div class="share-section">
                <button id="share-btn" class="share-button">
                    <span>üì§</span> –ü–æ–¥–µ–ª–∏—Ç—å—Å—è
                </button>
                <span id="share-status" class="share-status">–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!</span>
            </div>
        </main>
    </div>

    <footer>
        ¬© 2025 –°—Ç—Ä–∞—à–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.<br>
        <a href="about.html">–û –ø—Ä–æ–µ–∫—Ç–µ</a>
    </footer>

    <script src="stories-1min.js"></script>
    <script src="stories-5min.js"></script>
    <script src="stories.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–ª–æ–∞–¥–µ—Ä
            setTimeout(() => {
                const preloader = document.getElementById('preloader');
                preloader.classList.add('hidden');
                setTimeout(() => {
                    preloader.style.display = 'none';
                }, 500);
            }, 1000);

            initializeApp();
        });

        function initializeApp() {
            initializeTheme();
            initializeReadSystem();
            initializeFilters();
            initializeSearch();
            initializeShare();
            initializeCategories();
            initializeMobileSidebar();
            renderStories();
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–º–æ–π
        function initializeTheme() {
            const themeToggle = document.getElementById('theme-toggle');
            let theme = localStorage.getItem('theme') || 'dark';
            
            function setTheme(mode) {
                document.body.classList.toggle('light-mode', mode === 'light');
                themeToggle.textContent = mode === 'light' ? '‚òÄÔ∏è' : 'üåô';
                themeToggle.title = mode === 'light' ? '–¢–µ–º–Ω–∞—è —Ç–µ–º–∞' : '–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞';
            }
            
            setTheme(theme);
            
            themeToggle.addEventListener('click', () => {
                theme = theme === 'dark' ? 'light' : 'dark';
                localStorage.setItem('theme', theme);
                setTheme(theme);
            });
        }

        // –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö –∏—Å—Ç–æ—Ä–∏–π
        function initializeReadSystem() {
            // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö –∏—Å—Ç–æ—Ä–∏–π –∏–∑ localStorage
            window.readStories = JSON.parse(localStorage.getItem('readStories') || '[]');
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–º–µ—Ç–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–π/–Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–π
            window.toggleReadStatus = function(storyId) {
                if (window.readStories.includes(storyId)) {
                    window.readStories = window.readStories.filter(id => id !== storyId);
                } else {
                    window.readStories.push(storyId);
                }
                localStorage.setItem('readStories', JSON.stringify(window.readStories));
                renderStories(); // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            };
            
            // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ—Å—Ç–∏
            window.isStoryRead = function(storyId) {
                return window.readStories.includes(storyId);
            };
        }

        // –ü–æ–∏—Å–∫
        function initializeSearch() {
            const searchInput = document.getElementById('search-input');
            const searchClear = document.getElementById('search-clear');
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–≤–æ–¥–∞ –≤ –ø–æ–∏—Å–∫
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase().trim();
                updateSearchClear(searchTerm);
                renderStories();
            });

            // –û—á–∏—Å—Ç–∫–∞ –ø–æ–∏—Å–∫–∞
            searchClear.addEventListener('click', () => {
                searchInput.value = '';
                updateSearchClear('');
                renderStories();
                searchInput.focus();
            });

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ Enter –¥–ª—è –ø–æ–∏—Å–∫–∞
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    renderStories();
                }
            });

            function updateSearchClear(searchTerm) {
                searchClear.style.display = searchTerm ? 'block' : 'none';
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤ —Å–∞–π–¥–±–∞—Ä–µ
        function initializeCategories() {
            const categoryList = document.querySelector('.category-list');
            const categories = [...new Set(stories.map(s => s.category))];
            const readingTimes = [...new Set(stories.map(s => s.readingTime).filter(Boolean))];
            
            // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞
            window.selectedCategories = new Set();
            window.selectedReadingTimes = new Set();
            window.selectedReadStatus = null;
            
            // –ò–∫–æ–Ω–∫–∏ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
            const categoryIcons = {
                '–ü–∞—Ä–∞–Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ': 'üëª',
                '–¢–µ—Ö–Ω–æ—Ö–æ—Ä—Ä–æ—Ä': 'üíª',
                '–ü—Ä–æ–∫–ª—è—Ç–∏—è': 'üîÆ',
                '–£–±–∏–π—Ü—ã / –º–∞–Ω—å—è–∫–∏': 'üî™'
            };

            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–í—Å–µ –∏—Å—Ç–æ—Ä–∏–∏"
            const allStoriesBtn = document.querySelector('.category-btn[data-category="all"]');
            if (allStoriesBtn) {
                allStoriesBtn.addEventListener('click', () => {
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã
                    window.selectedCategories.clear();
                    window.selectedReadingTimes.clear();
                    window.selectedReadStatus = null;
                    
                    // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
                    document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active', 'multi-selected'));
                    // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ –∫–Ω–æ–ø–∫–µ "–í—Å–µ –∏—Å—Ç–æ—Ä–∏–∏"
                    allStoriesBtn.classList.add('active');
                    renderStories();
                });
            }

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ —Å—Ç–∞—Ç—É—Å—É —á—Ç–µ–Ω–∏—è
            document.querySelectorAll('.read-status-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const readStatus = btn.getAttribute('data-read-status');
                    
                    // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å "–í—Å–µ –∏—Å—Ç–æ—Ä–∏–∏"
                    document.querySelector('.category-btn[data-category="all"]').classList.remove('active');
                    
                    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Å—Ç–∞—Ç—É—Å
                    if (window.selectedReadStatus === readStatus) {
                        window.selectedReadStatus = null;
                        btn.classList.remove('active');
                    } else {
                        // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å –¥—Ä—É–≥–∏—Ö –∫–Ω–æ–ø–æ–∫ —Å—Ç–∞—Ç—É—Å–∞
                        document.querySelectorAll('.read-status-btn').forEach(b => b.classList.remove('active'));
                        window.selectedReadStatus = readStatus;
                        btn.classList.add('active');
                    }
                    
                    renderStories();
                });
            });



            // –°–æ–∑–¥–∞–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –¥–ª—è –≤—Ä–µ–º–µ–Ω–∏ —á—Ç–µ–Ω–∏—è
            const readingTimeHeader = document.createElement('div');
            readingTimeHeader.className = 'category-header';
            readingTimeHeader.innerHTML = '<h4>‚è±Ô∏è –í—Ä–µ–º—è —á—Ç–µ–Ω–∏—è</h4>';
            categoryList.appendChild(readingTimeHeader);

            // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —á—Ç–µ–Ω–∏—è
            readingTimes.sort().forEach(time => {
                const button = document.createElement('button');
                button.className = 'category-btn reading-time-btn multi-select-btn';
                button.setAttribute('data-reading-time', time);
                
                button.innerHTML = `
                    <span class="category-icon">‚è±Ô∏è</span>
                    <span class="category-name">${time}</span>
                `;
                
                button.addEventListener('click', () => {
                    // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å "–í—Å–µ –∏—Å—Ç–æ—Ä–∏–∏"
                    document.querySelector('.category-btn[data-category="all"]').classList.remove('active');
                    
                    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –≤—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏ —á—Ç–µ–Ω–∏—è
                    if (window.selectedReadingTimes.has(time)) {
                        window.selectedReadingTimes.delete(time);
                        button.classList.remove('multi-selected');
                    } else {
                        window.selectedReadingTimes.add(time);
                        button.classList.add('multi-selected');
                    }
                    
                    renderStories();
                });
                
                categoryList.appendChild(button);
            });

            // –°–æ–∑–¥–∞–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
            const categoriesHeader = document.createElement('div');
            categoriesHeader.className = 'category-header';
            categoriesHeader.innerHTML = '<h4>üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h4>';
            categoryList.appendChild(categoriesHeader);

            // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
            categories.forEach(cat => {
                const button = document.createElement('button');
                button.className = 'category-btn multi-select-btn';
                button.setAttribute('data-category', cat);
                
                button.innerHTML = `
                    <span class="category-icon">${categoryIcons[cat] || 'üìñ'}</span>
                    <span class="category-name">${cat}</span>
                `;
                
                button.addEventListener('click', () => {
                    // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å "–í—Å–µ –∏—Å—Ç–æ—Ä–∏–∏"
                    document.querySelector('.category-btn[data-category="all"]').classList.remove('active');
                    
                    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –≤—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                    if (window.selectedCategories.has(cat)) {
                        window.selectedCategories.delete(cat);
                        button.classList.remove('multi-selected');
                    } else {
                        window.selectedCategories.add(cat);
                        button.classList.add('multi-selected');
                    }
                    
                    renderStories();
                });
                
                categoryList.appendChild(button);
            });
        }

        // –§–∏–ª—å—Ç—Ä—ã –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
        function initializeFilters() {
            const sortButtons = document.querySelectorAll('.sort-btn');
            let currentSort = 'default';

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
            sortButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    sortButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentSort = btn.id.replace('sort-', '');
                    renderStories();
                });
            });

            // –§—É–Ω–∫—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –∏—Å—Ç–æ—Ä–∏–π
            window.renderStories = function() {
                const storiesList = document.getElementById('stories-list');
                const searchTerm = document.getElementById('search-input').value.toLowerCase().trim();
                let filtered = [...stories];

                // –ü–æ–∏—Å–∫ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É –∏ —Ç–µ–∫—Å—Ç—É
                if (searchTerm) {
                    filtered = filtered.filter(story => 
                        story.title.toLowerCase().includes(searchTerm) ||
                        story.text.toLowerCase().includes(searchTerm)
                    );
                }

                // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ—Å—Ç–∏
                if (window.selectedReadStatus) {
                    if (window.selectedReadStatus === 'read') {
                        filtered = filtered.filter(story => window.isStoryRead(story.id));
                    } else if (window.selectedReadStatus === 'unread') {
                        filtered = filtered.filter(story => !window.isStoryRead(story.id));
                    }
                }

                // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä)
                if (window.selectedCategories && window.selectedCategories.size > 0) {
                    filtered = filtered.filter(story => window.selectedCategories.has(story.category));
                }

                // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —á—Ç–µ–Ω–∏—è (–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä)
                if (window.selectedReadingTimes && window.selectedReadingTimes.size > 0) {
                    filtered = filtered.filter(story => window.selectedReadingTimes.has(story.readingTime));
                }

                // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω—ã –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –∏ –≤—Ä–µ–º—è —á—Ç–µ–Ω–∏—è - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –û–ë–û–ò–ú –∫—Ä–∏—Ç–µ—Ä–∏—è–º
                // (–ª–æ–≥–∏–∫–∞ –ò, –∞ –Ω–µ –ò–õ–ò)

                // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
                switch (currentSort) {
                    case 'alpha':
                        filtered.sort((a, b) => a.title.localeCompare(b.title, 'ru'));
                        break;
                    case 'reading':
                        filtered.sort((a, b) => {
                            if (!a.readingTime) return 1;
                            if (!b.readingTime) return -1;
                            return a.readingTime.localeCompare(b.readingTime, 'ru');
                        });
                        break;
                    default:
                        // –ü–æ—Ä—è–¥–æ–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–∫–∞–∫ –≤ –º–∞—Å—Å–∏–≤–µ)
                        break;
                }

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –∏—Å—Ç–æ—Ä–∏–π
                updateSearchResults(filtered.length, searchTerm);

                // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥
                storiesList.innerHTML = '';
                if (filtered.length === 0) {
                    storiesList.innerHTML = `
                        <li class="no-results">
                            <div class="no-results-content">
                                <h3>üîç –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
                                <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</p>
                            </div>
                        </li>
                    `;
                } else {
                    filtered.forEach(story => {
                        const li = document.createElement('li');
                        li.className = `story-item ${window.isStoryRead(story.id) ? 'read' : 'unread'}`;
                        
                        const link = document.createElement('a');
                        link.href = `story.html?id=${story.id}`;
                        link.className = 'story-link';
                        
                        // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ—Å—Ç–∏
                        const readToggle = document.createElement('button');
                        readToggle.className = 'read-toggle-btn';
                        readToggle.title = window.isStoryRead(story.id) ? '–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—É—é' : '–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—É—é';
                        readToggle.innerHTML = window.isStoryRead(story.id) ? '‚úÖ' : 'üìñ';
                        readToggle.onclick = (e) => {
                            e.preventDefault();
                            e.stopPropagation();
                            window.toggleReadStatus(story.id);
                        };
                        
                        link.innerHTML = `
                            <div class="story-title">${story.title}</div>
                            <div class="story-meta">
                                <span class="story-category">${story.category}</span>
                                <span class="story-reading-time">‚è±Ô∏è ${story.readingTime || ''}</span>
                                <span class="read-status ${window.isStoryRead(story.id) ? 'read' : 'unread'}">
                                    ${window.isStoryRead(story.id) ? '‚úÖ –ü—Ä–æ—á–∏—Ç–∞–Ω–æ' : 'üìñ –ù–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ'}
                                </span>
                            </div>
                        `;
                        
                        li.appendChild(link);
                        li.appendChild(readToggle);
                        storiesList.appendChild(li);
                    });
                }
            };
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
        function updateSearchResults(count, searchTerm) {
            const subtitle = document.querySelector('.subtitle');
            let text = '';
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç —Å —É—á–µ—Ç–æ–º –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
            const activeFilters = [];
            
            if (searchTerm) {
                activeFilters.push(`–ø–æ–∏—Å–∫: "${searchTerm}"`);
            }
            
            if (window.selectedReadStatus) {
                activeFilters.push(window.selectedReadStatus === 'read' ? '–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ' : '–Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ');
            }
            
            if (window.selectedCategories && window.selectedCategories.size > 0) {
                activeFilters.push(`–∫–∞—Ç–µ–≥–æ—Ä–∏–∏: ${Array.from(window.selectedCategories).join(', ')}`);
            }
            
            if (window.selectedReadingTimes && window.selectedReadingTimes.size > 0) {
                activeFilters.push(`–≤—Ä–µ–º—è: ${Array.from(window.selectedReadingTimes).join(', ')}`);
            }
            
            if (activeFilters.length > 0) {
                text = `–ù–∞–π–¥–µ–Ω–æ ${count} –∏—Å—Ç–æ—Ä–∏–π (${activeFilters.join(' | ')})`;
            } else {
                text = '–°–æ–±—Ä–∞–Ω–∏–µ —Å–∞–º—ã—Ö –∂—É—Ç–∫–∏—Ö —Ä–∞—Å—Å–∫–∞–∑–æ–≤ —Å –ø—Ä–æ—Å—Ç–æ—Ä–æ–≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞';
            }
            
            subtitle.textContent = text;
        }

        // –§—É–Ω–∫—Ü–∏—è "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è"
        function initializeShare() {
            const shareBtn = document.getElementById('share-btn');
            const shareStatus = document.getElementById('share-status');

            shareBtn.addEventListener('click', async () => {
                const shareData = {
                    title: document.title,
                    text: '–ß–∏—Ç–∞–π —Å—Ç—Ä–∞—à–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏!',
                    url: window.location.href
                };

                try {
                    if (navigator.share) {
                        await navigator.share(shareData);
                    } else {
                        await navigator.clipboard.writeText(window.location.href);
                        shareStatus.style.display = 'inline';
                        setTimeout(() => shareStatus.style.display = 'none', 2000);
                    }
                } catch (error) {
                    // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
                    const textArea = document.createElement('textarea');
                    textArea.value = window.location.href;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    shareStatus.style.display = 'inline';
                    setTimeout(() => shareStatus.style.display = 'none', 2000);
                }
            });
        }

        // –ú–æ–±–∏–ª—å–Ω—ã–π —Å–∞–π–¥–±–∞—Ä
        function initializeMobileSidebar() {
            const sidebarToggle = document.getElementById('sidebar-toggle');
            const sidebar = document.querySelector('.sidebar');
            
            // Force button to be visible on mobile if needed
            if (sidebarToggle && window.innerWidth <= 768) {
                sidebarToggle.style.display = 'block';
                sidebarToggle.style.visibility = 'visible';
                sidebarToggle.style.opacity = '1';
                sidebarToggle.style.pointerEvents = 'auto';
            }
            
            const overlay = document.createElement('div');
            overlay.className = 'sidebar-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 1000;
                opacity: 0;
                visibility: hidden;
                transition: all 0.3s ease;
            `;
            document.body.appendChild(overlay);

            function openSidebar() {
                sidebar.classList.add('open');
                overlay.style.opacity = '1';
                overlay.style.visibility = 'visible';
                document.body.style.overflow = 'hidden';
            }

            function closeSidebar() {
                sidebar.classList.remove('open');
                overlay.style.opacity = '0';
                overlay.style.visibility = 'hidden';
                document.body.style.overflow = '';
            }

            sidebarToggle.addEventListener('click', openSidebar);
            overlay.addEventListener('click', closeSidebar);

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ Escape
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && sidebar.classList.contains('open')) {
                    closeSidebar();
                }
            });

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—é (–¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è)
            document.querySelector('.category-list').addEventListener('click', (e) => {
                if (e.target.closest('.category-btn') && window.innerWidth <= 768) {
                    setTimeout(closeSidebar, 100); // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–∞
                }
            });
            
            // Handle window resize
            window.addEventListener('resize', () => {
                if (window.innerWidth <= 768) {
                    sidebarToggle.style.display = 'block';
                    sidebarToggle.style.visibility = 'visible';
                    sidebarToggle.style.opacity = '1';
                    sidebarToggle.style.pointerEvents = 'auto';
                } else {
                    sidebarToggle.style.display = 'none';
                }
            });
        }
    </script>
</body>
</html> 